<%-include("./partials/header.ejs")%>
    <main class="main">
      <section class="home-slider position-relative mb-30">
        <div class="container">
          <div class="home-slide-cover bg-grey-10 mt-30">
            <div
              class="hero-slider-1 style-4 dot-style-1 dot-style-1-position-1"
            >
            <!-- HERO SECTION IMAGE TOP TEXT -->
              <div class="single-hero-slider single-animation-wrap">
                <div class="container">
                  <div class="row align-items-center slider-animated-1">
                    <div class="col-lg-5 col-md-6">
                      <div class="hero-slider-content-2">
                        <h4 class="animated">Trade-In Offer</h4>
                        <h3 class="animated fw-900">Supper Value Deals</h3>
                        <h2 class="animated fw-900 text-brand">
                          On All Products
                        </h2>
                        <p class="animated">
                          Save more with coupons & up to 70% off
                        </p>
                        <a
                          class="animated btn btn-brush btn-brush-3"
                          href="shop-product-right.html"
                          tabindex="0"
                        >
                          Shop Now
                        </a>
                      </div>
                    </div>
                    <div class="col-lg-7 col-md-6">
                      <div class="single-slider-img single-slider-img-1">
                        <img
                          class="animated"
                          src="/userassets/imgs/slider/slider-6.png"
                          alt=""
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="single-hero-slider single-animation-wrap">
                <div class="container">
                  <div class="row align-items-center slider-animated-1">
                    <div class="col-lg-5 col-md-6">
                      <div class="hero-slider-content-2">
                        <h4 class="animated">Hot promotions</h4>
                        <h3 class="animated fw-900">Fashion Trending</h3>
                        <h2 class="animated fw-900 text-brand">
                          Great Collection
                        </h2>
                        <p class="animated">
                          Save more with coupons & up to 20% off
                        </p>
                        <a
                          class="animated btn btn-brush btn-brush-1"
                          href="shop-product-right.html"
                          tabindex="0"
                        >
                          Get It Now
                        </a>
                      </div>
                    </div>
                    <div class="col-lg-7 col-md-6">
                      <div class="single-slider-img single-slider-img-1">
                        <img
                          class="animated"
                          src="/userassets/imgs/slider/slider-7.png"
                          alt=""
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="slider-arrow hero-slider-1-arrow"></div>
          </div>
        </div>
      </section>
            <!-- BELOW THE BANNER SALE SECRTIONS -->
      <!-- <section class="banners mb-20"> -->
        <!-- <div class="container">
          <div class="row">
            <div class="col-lg-4 col-md-6">
              <div class="banner-img wow fadeIn animated">
                <img src="/userassets/imgs/banner/banner-1.png" alt="" />
                <div class="banner-text">
                  <span>Smart Offer</span>
                  <h4>Save 20% on <br />Woman Bag</h4>
                  <a href="shop-grid-right.html"
                    >Shop Now <i class="fi-rs-arrow-right"></i
                  ></a>
                </div>
              </div>
            </div>
            <div class="col-lg-4 col-md-6">
              <div class="banner-img wow fadeIn animated">
                <img src="/userassets/imgs/banner/banner-2.png" alt="" />
                <div class="banner-text">
                  <span>Sale off</span>
                  <h4>Great Summer <br />Collection</h4>
                  <a href="shop-grid-right.html"
                    >Shop Now <i class="fi-rs-arrow-right"></i
                  ></a>
                </div>
              </div>
            </div>
            <div class="col-lg-4 d-md-none d-lg-flex">
              <div class="banner-img wow fadeIn animated mb-sm-0">
                <img src="/userassets/imgs/banner/banner-3.png" alt="" />
                <div class="banner-text">
                  <span>New Arrivals</span>
                  <h4>Shop Today’s <br />Deals & Offers</h4>
                  <a href="shop-grid-right.html"
                    >Shop Now <i class="fi-rs-arrow-right"></i
                  ></a>
                </div>
              </div>
            </div>
          </div>
        </div> -->
      <!-- </section> -->
      <section class="product-tabs pt-25 pb-20 wow fadeIn animated">
        <div class="container">
          <div class="row">
            <div class="col-lg-3">
              <!-- <div class="widget-category mb-30">
                <h5 class="section-title style-1 mb-30 wow fadeIn animated">
                  Brands
                </h5>
                <ul class="categories">
                  <li><a href="shop-grid-right.html">Apple</a></li>
                  <li><a href="shop-grid-right.html">ASUS</a></li>
                  <li><a href="shop-grid-right.html">Dell</a></li>
                  <li><a href="shop-grid-right.html">HP</a></li>
                  <li><a href="shop-grid-right.html">Beauty</a></li>
                  <li><a href="shop-grid-right.html">Jewelry & Watch</a></li>
                  <li><a href="shop-grid-right.html">Accessories</a></li>
                </ul>
              </div> -->
              <!-- <div class="widget-category mb-30">
                <h5 class="section-title style-1 mb-30 wow fadeIn animated">
                  Price Range
                </h5>
                <ul class="categories">
                  <li><a href="shop-grid-right.html">10000-20000</a></li>
                  <li><a href="shop-grid-right.html">20000-40000</a></li>
                  <li><a href="shop-grid-right.html">40000-60000</a></li>
                  <li><a href="shop-grid-right.html">60000-80000</a></li>
                  <li><a href="shop-grid-right.html">80000-100000</a></li>
                  <li><a href="shop-grid-right.html">above 100000</a></li>

                </ul>

              </div> -->
              <!-- <div class="widget-category mb-30">
                <h5 class="section-title style-1 mb-30 wow fadeIn animated">
                  RAM SIZE
                </h5>
                <ul class="categories">
                  <li><a href="shop-grid-right.html">2GB</a></li>
                  <li><a href="shop-grid-right.html">4GB</a></li>
                  <li><a href="shop-grid-right.html">8GB</a></li>
                  <li><a href="shop-grid-right.html">16GB</a></li>
                  <li><a href="shop-grid-right.html">80000-100000</a></li>
                  <li><a href="shop-grid-right.html">100000-120000</a></li>

                </ul>
              </div> -->
              <form action="/user/filter-sort" method="post" class="row">
                <div class="col-md-12">
                  <div class="widget-category mb-30">
                    <h5 class="section-title style-1 mb-30 wow fadeIn animated">
                        Sort by
                    </h5>
                    <ul class="categories">
                        <li class="form-check">
                            <input type="radio" class="form-check-input " id="viewAll" value="viewAll" name="sort" >
                            <label class="form-check-label" for="popularity">View All</label>
                        </li>
                        <li class="form-check">
                            <input type="radio" class="form-check-input" id="lowToHigh" value="lowToHigh" name="sort">
                            <label class="form-check-label" for="lowToHigh">Price: Low to High</label>
                        </li>
                        <li class="form-check">
                            <input type="radio" class="form-check-input" id="highToLow" value="highToLow" name="sort">
                            <label class="form-check-label" for="highToLow">Price: High to Low</label>
                        </li>
                    </ul>
                </div>                
                </div>
                <div class="col-md-12">
                    <div class="widget-category mb-30">
                        <h5 class="section-title style-1 mb-30 wow fadeIn animated">
                            Categories
                        </h5>
                        <ul class="categories">
                            <% category.forEach((catgory) => { %>
                                <li class="form-check">
                                    <input type="checkbox" class="form-check-input " id="<%= catgory.categoryName%>" name="categories" value="<%= catgory._id%>">
                                    <label class="form-check-label" for="<%= catgory.categoryName%>"><%= catgory.categoryName%></label>
                                </li>
                            <% }) %>
                        </ul>
                    </div>
                </div>
                <div class="col-md-12 d-flex align-items-center justify-content-center mt--30">
                    <button type="submit" class="btn btn-primary APPLYFILTER">Apply Filter</button>
                </div>
            </form>
          </div>
            <div class="col-lg-9">
              <div class="tab-content wow fadeIn animated" id="myTabContent">
                <div
                  class="tab-pane fade show active"
                  id="tab-one"
                  role="tabpanel"
                  aria-labelledby="tab-one"
                >
 <!--BODY PRODUCT START  -->
          <%if(products.length > 0){%>
                  <div class="row product-grid-4">
                    <% products.forEach((e)=>{ %>
                    <div class="col-lg-4 col-md-4 col-12 col-sm-6">
                      <div class="product-cart-wrap mb-30">
<!-- ejs starts -->
                        <div class="product-img-action-wrap">
                          <div class="product-img product-img-zoom">
                            <% if (e && e.images && e.images.length > 0 && e.images[0]?.path) { %>
                            <a href="/user/product-details/<%= e._id%>">
                                <!-- BODY HOME FIRST IMAGE -->
                              <img
                                class="default-img"
                                src="<%= e.images[0]?.path %>"
                                alt="image"
                              />
                              <img
                                class="hover-img"
                                src="<%= e.images[1]?.path %>"
                                alt="image"
                              />
                            </a>
                            <% } %>
                          </div>
                          <%if(e.discountStatus === "Active"){%>
                          <div class="product-badges product-badges-position product-badges-mrg">
                            <span class="sale ">Sale</span>
                          </div>
                          <%}%>
                          <div class="product-action-1">
                            <button
                              type="button"
                              aria-label="Add To Wishlist"
                              class="action-btn hover-up WISHLIST"
                              prdctId = "<%= e._id %>"
                              ><i class="fi-rs-heart"></i
                            ></button>
                          </div>
                          
                          <!-- <div
                            class="product-badges product-badges-position product-badges-mrg"
                          >
                            <span class="hot">Hot</span>
                          </div> -->
                        </div>
                        <div class="product-content-wrap">
                          <div class="product-category">
                            <a href="/user/product-details/<%= e._id%>"><%= e.brand%></a>
                          </div>
                          <h2>
                            <a href="/user/product-details/<%= e._id%>"
                              ><%= e.productName%></a
                            >
                          </h2>
                          <!-- <div class="rating-result" title="90%">
                            <span>
                              <span>90%</span>
                            </span>
                          </div> -->
                          <%if(e.discountStatus === "Active" ){%>
                            <div class="product-price">
                              <span>₹ <%= e.salesPrice - e.offerAmount %></span>
                              <span class="old-price">₹ <%= e.salesPrice%></span>
                            </div>
                          <%}else{%>
                            <div class="product-price">
                              <span>₹ <%= e.salesPrice%></span>
                            </div>
                            <%}%>
                          <div class="product-action-1 show">
                            <button
                              aria-label="Add To Cart"
                              class="action-btn hover-up CART"
                              type="button"
                              prdctId = "<%= e._id %>"
                              ><i class="fi-rs-shopping-bag-add"></i
                            ></button>
                          </div>
                        </div>
                        <!-- ejs ends -->
                      </div>
                      
                    </div>
                    <% }) %>
                <!--End product-grid-4-->
                </div>
                

                </div>
                <%}else{%>
                  <div class="container">
                    <div class="text-danger d-flex align-items-center justify-content-center bg-secondary text-light p-4">
                      <div class="bg-white p-10">
                       <h4 class="text-danger"> Sorry No Product Found</h4>
                      </div>
                    </div>
                  </div>
                  <% } %>
            </div>
          </div>
          <div class="page-buttons d-flex justify-content-center mt-4">
            <nav aria-label="Page navigation">
              <ul class="pagination">
                <% for (let i = 1; i <= totalPages; i++) { %>
                  <% if (i === page) { %>
                

                    <li class="page-item <% (i === page) ? 'active' : '' %>" aria-current="page">
                      <span class="page-link">
                        <%= i %>
                        <span class="visually-hidden">(current)</span>
                      </span>
                    </li>
                  <% } else { %>
                    <li class="page-item">
                      <a class="page-link" href="/user/?page=<%= i %>">
                        <%= i %> 
                      </a>
                    </li>
                  <% } %>
                <% } %>
              </ul>
            </nav>
          </div>
          
          
          
        </div>
      </section>

    </main>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", async (event) => {
        const addToCartBtn = document.querySelectorAll(".CART");
        addToCartBtn.forEach((element) => {
          element.addEventListener("click", async (event) => {
            event.preventDefault();
            const productId = element.getAttribute("prdctId");
      
            try {
              const response = await axios.post("/user/add-to-cart", {
                productId: productId,
              })
              const data = response.data;
              if (data.message) {
                Swal.fire({
                  title: data.message,
                  icon: "success",
                  showConfirmButton: false,
                  timer: 2000,
                  timerProgressBar: true,
                });
              }else if(data.productExsist){
                setTimeout(()=>{
                  window.location.href=`/user/load-cart?quantity=${data.quantity}&productId=${data.productId}`
                })
              } else  {
                Swal.fire({
                  title: data.error,
                  text: "Sorry",
                  icon: "error",
                  confirmButtonText: "Ok",
                  timer: 2000,
                  timerProgressBar: true,
                });
              }
            } catch (error) {
              Swal.fire({
                title: "Sorry!",
                text: "An error occurred.",
                icon: "error",
                confirmButtonText: "Ok",
                timer: 2000,
                timerProgressBar: true,
              });
            }
          });
        });
         const wishlistBtn = document.querySelectorAll(".WISHLIST")
          wishlistBtn.forEach((element) =>{
            element.addEventListener("click",async function(event){
              event.preventDefault();
              const productId = element.getAttribute("prdctId");
              try {
                const response = await axios.post(`/user/add-to-wishlist?productId=${productId}`)
                const data = response.data
                if(data){
                  Swal.fire({
                  title:(data.message)?'success':'Sorry',
                  text: (data.message)?data.message:data.error,
                  icon: (data.message)?'success':'error',
                  confirmButtonText: "Ok",
                  timer: 1500,
                  timerProgressBar: true,
                });
                }
              } catch (error) {
                Swal.fire({
                title: "Sorry!",
                text: error,
                icon: "error",
                confirmButtonText: "Ok",
                timer: 2000,
                timerProgressBar: true,
                })
              }

          }) 
        })
      });
      </script>
      
<%-include("./partials/footer.ejs")%>